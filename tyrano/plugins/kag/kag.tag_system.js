tyrano.plugin.kag.tag.eval={vital:["exp"],pm:{exp:"",next:"true"},start:function(pm){this.kag.evalScript(pm.exp);if(pm.next=="true")this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.clearvar={pm:{},start:function(pm){this.kag.clearVariable();this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.clearsysvar={start:function(){this.kag.variable.sf={};this.kag.ftag.nextOrder()}};
tyrano.plugin.kag.tag.clearstack={pm:{stack:""},start:function(pm){if(pm.stack=="")this.kag.stat.stack={"if":[],"call":[],"macro":[]};else this.kag.stat.stack[pm.stack]=[];this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag["trace"]={pm:{exp:""},start:function(pm){var val=this.kag.embScript(pm.exp);this.kag.log("trace\u51fa\u529b\uff1a"+val);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag["title"]={vital:["name"],pm:{name:""},start:function(pm){if(pm.name!=""){this.kag.setTitle(pm.name);this.kag.ftag.nextOrder()}}};
tyrano.plugin.kag.tag.iscript={start:function(pm){this.kag.stat.is_script=true;this.kag.stat.buff_script="";this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.endscript={pm:{stop:"false"},start:function(pm){this.kag.stat.is_script=false;this.kag.evalScript(this.kag.stat.buff_script);this.kag.stat.buff_script="";if(pm.stop=="false")this.kag.ftag.nextOrder()}};
tyrano.plugin.kag.tag.emb={vital:["exp"],pm:{exp:""},log_join:"true",start:function(pm){var val=""+this.kag.embScript(pm.exp);this.kag.ftag.startTag("text",{"val":val})}};
tyrano.plugin.kag.tag["if"]={vital:["exp"],pm:{"exp":""},log_join:"true",start:function(pm){if(this.kag.embScript(pm.exp)){this.kag.pushStack("if",{bool:true,deep:pm.deep_if});this.kag.ftag.nextOrder()}else{this.kag.pushStack("if",{bool:false,deep:pm.deep_if});for(var i=0;i<2E3;i++){var r=this.kag.ftag.nextOrderWithTag({"else":"","elsif":"","endif":""});if(r==true)break}if(i>1900)this.kag.error("If\u6587\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059")}}};
tyrano.plugin.kag.tag["elsif"]={vital:["exp"],pm:{"exp":""},log_join:"true",start:function(pm){if(this.kag.getStack("if").bool==false&&this.kag.embScript(pm.exp)){this.kag.setStack("if",{bool:true,deep:pm.deep_if});this.kag.ftag.nextOrder()}else{for(var i=0;i<2E3;i++){var r=this.kag.ftag.nextOrderWithTag({"else":"","elsif":"","endif":""});if(r==true)break}if(i>1900)this.kag.error("If\u6587\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059")}}};
tyrano.plugin.kag.tag["else"]={pm:{"exp":""},log_join:"true",start:function(pm){if(this.kag.getStack("if").bool==false){this.kag.setStack("if",{bool:true,deep:pm.deep_if});this.kag.ftag.nextOrder()}else{for(var i=0;i<2E3;i++){var r=this.kag.ftag.nextOrderWithTag({"endif":""});if(r==true)break}if(i>1900)this.kag.error("If\u6587\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059")}}};tyrano.plugin.kag.tag["endif"]={log_join:"true",start:function(){this.kag.popStack("if");this.kag.ftag.nextOrder()}};
tyrano.plugin.kag.tag["call"]={pm:{storage:null,target:null,countpage:true,auto_next:"yes"},start:function(pm){var back_pm={};back_pm.index=this.kag.ftag.current_order_index;back_pm.storage=this.kag.stat.current_scenario;back_pm.auto_next=pm.auto_next;back_pm.caller=pm;this.kag.pushStack("call",back_pm);if(pm.target==null&&pm.storage!=null)this.kag.ftag.nextOrderWithIndex(-1,pm.storage);else this.kag.ftag.nextOrderWithLabel(pm.target,pm.storage)}};
tyrano.plugin.kag.tag["return"]={start:function(){var pm=this.kag.getStack("call");if(pm.caller&&pm.caller.storage)if(pm.caller.storage=="make.ks")if(this.kag.tmp.loading_make_ref==true){this.kag.stat.flag_ref_page=true;this.kag.tmp.loading_make_ref=false}var auto_next=pm.auto_next;this.kag.popStack("call");this.kag.ftag.nextOrderWithIndex(pm.index,pm.storage,undefined,undefined,auto_next)}};
tyrano.plugin.kag.tag.macro={vital:["name"],pm:{name:""},log_join:"true",start:function(pm){var index=this.kag.ftag.current_order_index;var storage=this.kag.stat.current_scenario;this.kag.stat.map_macro[pm.name]={"storage":storage,"index":index};this.kag.tmp.checking_macro=true;for(var i=0;i<2E3;i++){var r=this.kag.ftag.nextOrderWithTag({"endmacro":""});if(r==true)break}if(i>1900)this.kag.error("\u30de\u30af\u30ed\u304c\u9589\u3058\u3066\u3044\u307e\u305b\u3093")}};
tyrano.plugin.kag.tag.endmacro={log_join:"true",start:function(pm){if(this.kag.tmp.checking_macro==true){this.kag.tmp.checking_macro=false;this.kag.ftag.nextOrder();return}var map_obj=this.kag.getStack("macro");if(map_obj){this.kag.popStack("macro");this.kag.stat.mp=this.kag.getStack("macro");this.kag.ftag.nextOrderWithIndex(map_obj.index,map_obj.storage,true)}else;}};tyrano.plugin.kag.tag.erasemacro={vital:["name"],pm:{name:""},start:function(pm){delete this.kag.stat.map_macro[pm.name];this.kag.ftag.nextOrder()}};
tyrano.plugin.kag.tag.ignore={vital:["exp"],pm:{exp:""},start:function(pm){if(this.kag.embScript(pm.exp)){for(var i=0;i<2E3;i++){var r=this.kag.ftag.nextOrderWithTag({"endignore":""});if(r==true)break}if(i>1900)this.kag.error("ignore\u304c\u9589\u3058\u3066\u3044\u307e\u305b\u3093")}else this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.endignore={start:function(){this.kag.ftag.nextOrder()}};
tyrano.plugin.kag.tag.plugin={vital:["name"],pm:{name:"",storage:"init.ks"},start:function(pm){var storage_url="";var name=pm.name;pm.storage="../others/plugin/"+name+"/"+pm.storage;this.kag.stat.mp=pm;this.kag.ftag.startTag("call",pm)}};tyrano.plugin.kag.tag.start_keyconfig={pm:{},start:function(pm){this.kag.stat.enable_keyconfig=true;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.stop_keyconfig={pm:{},start:function(pm){this.kag.stat.enable_keyconfig=false;this.kag.ftag.nextOrder()}};
